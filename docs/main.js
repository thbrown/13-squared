(()=>{var e={341:(e,t)=>{!function(e){e.BloomFilter=n,e.fnv_1a=r;var t="undefined"!=typeof ArrayBuffer;function n(e,n){var o;"number"!=typeof e&&(e=32*(o=e).length);var r=Math.ceil(e/32),i=-1;if(this.m=e=32*r,this.k=n,t){var a=1<<Math.ceil(Math.log(Math.ceil(Math.log(e)/Math.LN2/8))/Math.LN2),s=1===a?Uint8Array:2===a?Uint16Array:Uint32Array,l=new ArrayBuffer(a*n),c=this.buckets=new Int32Array(r);if(o)for(;++i<r;)c[i]=o[i];this._locations=new s(l)}else{c=this.buckets=[];if(o)for(;++i<r;)c[i]=o[i];else for(;++i<r;)c[i]=0;this._locations=[]}}function o(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24}function r(e,t){for(var n=2166136261^(t||0),o=0,r=e.length;o<r;++o){var a=e.charCodeAt(o),s=65280&a;s&&(n=i(n^s>>8)),n=i(n^255&a)}return function(e){return e+=e<<13,e^=e>>>7,e+=e<<3,e^=e>>>17,e+=e<<5,4294967295&e}(n)}function i(e){return e+(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24)}n.prototype.locations=function(e){for(var t=this.k,n=this.m,o=this._locations,i=r(e),a=r(e,1576284489),s=i%n,l=0;l<t;++l)o[l]=s<0?s+n:s,s=(s+a)%n;return o},n.prototype.add=function(e){for(var t=this.locations(e+""),n=this.k,o=this.buckets,r=0;r<n;++r)o[Math.floor(t[r]/32)]|=1<<t[r]%32},n.prototype.test=function(e){for(var t=this.locations(e+""),n=this.k,o=this.buckets,r=0;r<n;++r){var i=t[r];if(!(o[Math.floor(i/32)]&1<<i%32))return!1}return!0},n.prototype.size=function(){for(var e=this.buckets,t=0,n=0,r=e.length;n<r;++n)t+=o(e[n]);return-this.m*Math.log(1-t/this.m)/this.k}}(t)}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{"use strict";function e(e,t,n,o){const r=["VERTEX_SHADER","FRAGMENT_SHADER"],i=t.map(((t,n)=>function(e,t,n){const o=document.getElementById(t);return function(e,t,n){const o=e.createShader(n);return e.shaderSource(o,t),e.compileShader(o),o}(e,o.text,n||("x-shader/x-vertex"===o.type?e.VERTEX_SHADER:e.FRAGMENT_SHADER))}(e,t,e[r[n]]))),a=e.createProgram();return i.forEach((t=>e.attachShader(a,t))),n&&n.forEach(((t,n)=>e.bindAttribLocation(a,o?o[n]:n,t))),e.linkProgram(a),a}let t=Float32Array;function o(e,n,o,a){a=a||new t(16);var s=i(function(e,n,o){return o=o||new t(3),o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],o}(e,n)),l=i(r(o,s)),c=i(r(s,l));return a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=0,a[4]=c[0],a[5]=c[1],a[6]=c[2],a[7]=0,a[8]=s[0],a[9]=s[1],a[10]=s[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}function r(e,n,o){return(o=o||new t(3))[0]=e[1]*n[2]-e[2]*n[1],o[1]=e[2]*n[0]-e[0]*n[2],o[2]=e[0]*n[1]-e[1]*n[0],o}function i(e,n){n=n||new t(3);var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return o>1e-5&&(n[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o),n}const{BloomFilter:a}=n(341),s={red:0,blue:1,green:2},l={0:"red",1:"blue",2:"green"},c=()=>{const e=document.querySelectorAll(".square"),t=(e=>{let t="";return e.forEach((e=>{const n=s[e].toString(2).padStart(2,"0");t+=n})),t})(Array.from(e).map((e=>e.style.backgroundColor)));return u(t)},u=e=>{e=e.padEnd(8*Math.ceil(e.length/8),"0");const t=[];for(let n=0;n<e.length;n+=8)t.push(parseInt(e.substring(n,n+8),2));const n=new Uint8Array(t);let o=btoa(String.fromCharCode.apply(null,n));return o=o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),o},d=(e,t)=>{const n=2*t,o=h(e).substring(0,n);if(o.length!==n)throw new Error("Decoded binary string does not match the expected length.");const r=[];for(let e=0;e<o.length;e+=2){const t=parseInt(o.substring(e,e+2),2);r.push(l[t])}return r},h=e=>{switch((e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4){case 2:e+="==";break;case 3:e+="="}const t=atob(e);let n="";for(let e=0;e<t.length;e++)n+=t.charCodeAt(e).toString(2).padStart(8,"0");return n},g=(e,t,n)=>{let o=Math.floor(e/t),r=e%t;const i=[];for(let e=-1;e<=1;e++)for(let a=-1;a<=1;a++)if(0===e&&0===a);else{let s=o+e,l=r+a;if(s>=0&&s<n&&l>=0&&l<t){let e=s*t+l;i.push(e)}}return i},f=e=>{switch(e){case 0:case 1:return[4,2,5,3];case 2:case 3:return[4,5,0,1];case 4:case 5:return[2,3,0,1];default:throw new Error("Invalid face index")}},m=(e,t,n,o,r)=>{const i=performance.now(),l=d(e,t*n);console.log("Checking game",l,t,n,o);const c=new a(288e7,12),u=[],h=[],m={};for(let e=0;e<t*n;e++)m[e]=o?f(e):g(e,n,t);console.log("Adjacent indices",m),u.push({currentState:l.map((e=>s[e])),index:0,moves:[]});let y=!1,v=0,E=0,p=0;for(;u.length>0||h.length>0;){0===u.length?(y=!0,v=h.length,E=0):E>=v&&(y=!1),E++;const{currentState:e,index:t,moves:n}=y?h.shift():u.shift();if(t>=e.length)continue;if(e.every((e=>e===s.red)))return console.log("Hint time taken:",performance.now()-i),n;if(p!==n.length&&(p=n.length,null!=r&&n.length>=r))return console.log(`Solution is more than ${r} moves away!`),null;const o=e.join("")+"-"+t;if(c.test(o))continue;c.add(o);const a=[...e];a[t]=(a[t]+1)%3;for(let e of m[t])a[e]=(a[e]+1)%3;h.push({currentState:a,index:0,moves:[...n,t]}),u.push({currentState:e,index:t+1,moves:n})}return console.log("Hint time taken:",performance.now()-i),null},y=e=>new Promise(((t,n)=>{const o=new Image;o.onload=function(){try{t(o)}catch(e){n(e)}},o.onerror=function(e){n(e)},o.src=e.toDataURL("image/png")})),v=(e,t=!1)=>{const n=document.getElementById("canvas-img"),o=n.getContext("2d"),r=2048;e.forEach(((e,i)=>{const a=e.color,s=e.value;o.save(),t&&(o.scale(-1,1),o.translate(-n.width,0)),o.fillStyle=a,o.fillRect(i*r,0,r,r),o.strokeStyle="black",o.lineWidth=10,o.strokeRect(i*r,0,r,r),o.font="bold 500pt Luminari";const l=s.split("").join(String.fromCharCode(8202));o.fillStyle=function(e,t,n,o){let r,i,a,s,l,c,u,d=null,h=parseInt,g=Math.round,f="string"==typeof n;if("number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||n&&!f)return null;d||(d=e=>{let t=e.length,n={};if(t>9){if([r,i,a,f]=e=e.split(","),t=e.length,t<3||t>4)return null;n.r=h("a"==r[3]?r.slice(5):r.slice(4)),n.g=h(i),n.b=h(a),n.a=f?parseFloat(f):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?e[4]+e[4]:"")),e=h(e.slice(1),16),9==t||5==t?(n.r=e>>24&255,n.g=e>>16&255,n.b=e>>8&255,n.a=g((255&e)/.255)/1e3):(n.r=e>>16,n.g=e>>8&255,n.b=255&e,n.a=-1)}return n});if(u=t.length>9,u=f?n.length>9||"c"==n&&!u:u,l=d(t),s=e<0,c=n&&"c"!=n?d(n):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(e=s?-1*e:e),!l||!c)return null;o?(r=g(s*l.r+e*c.r),i=g(s*l.g+e*c.g),a=g(s*l.b+e*c.b)):(r=g((s*l.r**2+e*c.r**2)**.5),i=g((s*l.g**2+e*c.g**2)**.5),a=g((s*l.b**2+e*c.b**2)**.5));return f=l.a,c=c.a,l=f>=0||c>=0,f=l?f<0?c:c<0?f:f*s+c*e:0,u?"rgb"+(l?"a(":"(")+r+","+i+","+a+(l?","+g(1e3*f)/1e3:"")+")":"#"+(4294967296+16777216*r+65536*i+256*a+(l?g(255*f):0)).toString(16).slice(1,l?void 0:-2)}(.7,a);const c=o.measureText(l),u=c.width,d=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,h=i*r+1024-u/2,g=(r+d)/2;o.fillText(l,h,g),o.restore()}))};let E=!1;function p(n){v([{color:"#ff4949",value:"11"},{color:"#9c27b0",value:"14"},{color:"#4caf50",value:"12"},{color:"#ffcc00",value:"13"}],!0);const r=[0,0,.25,0,0,1,0,1,.25,0,.25,1],i=[.25,0,.5,0,.25,1,.25,1,.5,0,.5,1],a=[.5,0,.75,0,.5,1,.5,1,.75,0,.75,1],s=[.75,0,1,0,.75,1,.75,1,1,0,1,1],l=[0,0,.25,0,0,1,.25,0,.25,1,0,1],c=[.25,0,.5,0,.25,1,.5,0,.5,1,.25,1],u=[.5,0,.75,0,.5,1,.75,0,.75,1,.5,1],d=[.75,0,1,0,.75,1,1,0,1,1,.75,1],h=[0,1,2,0,1,2];let g=h,f=2,m=null;var p=null,A=null,w=null;function b(e){var t=new Float32Array([-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]);e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}function B(e,t){e.bufferData(e.ARRAY_BUFFER,new Float32Array([...x(t[0],!0),...x(t[1]),...x(t[2],!0),...x(t[3]),...x(t[4],!0),...x(t[5])]),e.STATIC_DRAW)}function R(e,t){let n=new Float32Array(36),o=6*t;for(let e=o;e<o+6;e++)n[e]=1;console.log("Flash data:",n.length,n),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}function x(e,t=!1){return 0===e?t?l:r:1===e?t?c:i:2===e?t?u:a:3===e?t?d:s:(console.warn("Invalid texture index:",e),alert("Invalid texture index:"+e),null)}return function(){var r=document.querySelector("#game-canvas-3d"),i=r.getContext("webgl");if(!i)return;m=i,p=i.createBuffer(),A=i.createBuffer(),w=i.createBuffer();let a=-1,s=-1,l=-1,c=!1,u=0;var d=V(60),v=V(0),x=V(0);function I(e){const t=r.getBoundingClientRect();return e.touches&&e.touches.length>0?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:e.changedTouches&&e.changedTouches.length>0?{x:e.changedTouches[0].clientX-t.left,y:e.changedTouches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}const k=e=>{if(u>10)return;u=0;const t=e=>{e.forEach((e=>{g[e]=(g[e]+1)%3}))};switch(l){case 1:t([0,4,2,5,3]);break;case 2:t([1,4,2,5,3]);break;case 3:t([2,4,5,0,1]);break;case 4:t([3,4,5,0,1]);break;case 5:t([4,2,3,0,1]);break;case 6:t([5,2,3,0,1]);break;case-1:break;default:console.log("Unknown color",l)}f=-1,i.bindBuffer(i.ARRAY_BUFFER,A),R(i,f),async function(){console.log("Changing texture...",g);try{i.bindBuffer(i.ARRAY_BUFFER,p),B(i,g),console.log("Texture changed successfully!")}catch(e){console.error("Error updating texture:",e),alert("Error updating texture:"+e)}}(),setTimeout(_,100)};function F(e){e.preventDefault();const{x:t,y:n}=I(e);if(a=t,s=n,c){let t=e.touches?e.touches[0].clientX-T:e.movementX,n=e.touches?e.touches[0].clientY-M:e.movementY;u+=Math.abs(t)+Math.abs(n),x+=t/100,v+=n/100,e.touches&&(T=e.touches[0].clientX,M=e.touches[0].clientY)}}i.canvas.addEventListener("mousemove",F),i.canvas.addEventListener("mousedown",(e=>{c=!0,u=0})),i.canvas.addEventListener("mouseup",(e=>{c=!1}));let T=0,M=0;i.canvas.addEventListener("touchstart",(e=>{c=!0,u=0;const{x:t,y:n}=I(e);a=t,s=n,T=e.touches[0].clientX,M=e.touches[0].clientY,e.preventDefault()})),i.canvas.addEventListener("touchmove",F),i.canvas.addEventListener("touchend",(e=>{c=!1})),i.canvas.addEventListener("click",k),i.canvas.addEventListener("touchend",(e=>{k(),e.preventDefault()}));const L=0;function _(){let e=!0;for(let t=0;t<g.length;t++)if(g[t]!==L){e=!1;break}e&&n()}!async function(){const e=await y(document.getElementById("canvas-img"));i.bindTexture(i.TEXTURE_2D,O),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.generateMipmap(i.TEXTURE_2D)}();const S=e(i,["pick-vertex-shader","pick-fragment-shader"]);var U=i.getAttribLocation(S,"a_position"),C=i.getAttribLocation(S,"a_picking_color"),D=i.getUniformLocation(S,"u_matrix"),Y=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,Y),function(e){var t=[1,2,3,4,5,6].map((e=>e/255)),n=[];t.forEach((e=>{for(var t=0;t<6;t++)n.push(e)})),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW)}(i);var H=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,H),b(i);var P=e(i,["vertex-shader-3d","fragment-shader-3d"]),N=i.getAttribLocation(P,"a_position"),q=i.getAttribLocation(P,"a_texcoord"),G=i.getAttribLocation(P,"a_flash"),$=i.getUniformLocation(P,"u_matrix"),X=i.getUniformLocation(P,"u_texture"),W=i.getUniformLocation(P,"u_time");i.bindBuffer(i.ARRAY_BUFFER,w),b(i),i.bindBuffer(i.ARRAY_BUFFER,p),B(i,h),i.bindBuffer(i.ARRAY_BUFFER,A),R(i,f);var O=i.createTexture();function V(e){return e*Math.PI/180}i.bindTexture(i.TEXTURE_2D,O),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,0,255,0,255,0,0,255,255,0])),requestAnimationFrame((function e(){let n=(Date.now()-j)/1e3;if(function(e,t=1){const n=e.clientWidth*t|0,o=e.clientHeight*t|0;(e.width!==n||e.height!==o)&&(e.width=n,e.height=o)}(i.canvas),i.viewport(0,0,i.canvas.width,i.canvas.height),i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),E){const e=V(1);d=Math.min(Math.PI,d+e);const t=V(10),n=V(10);v+=t,x+=n}let r=i.canvas.clientWidth/i.canvas.clientHeight,c=function(e,n,o,r,i){i=i||new t(16);var a=Math.tan(.5*Math.PI-.5*e),s=1/(o-r);return i[0]=a/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(o+r)*s,i[11]=-1,i[12]=0,i[13]=0,i[14]=o*r*s*2,i[15]=0,i}(d,r,1,2e3),u=function(e,n){n=n||new t(16);var o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],g=e[10],f=e[11],m=e[12],y=e[13],v=e[14],E=e[15],p=g*E,A=v*f,w=c*E,b=v*u,B=c*f,R=g*u,x=i*E,I=v*a,k=i*f,F=g*a,T=i*u,M=c*a,L=d*y,_=m*h,S=s*y,U=m*l,C=s*h,D=d*l,Y=o*y,H=m*r,P=o*h,N=d*r,q=o*l,G=s*r,$=p*l+b*h+B*y-(A*l+w*h+R*y),X=A*r+x*h+F*y-(p*r+I*h+k*y),W=w*r+I*l+T*y-(b*r+x*l+M*y),O=R*r+k*l+M*h-(B*r+F*l+T*h),V=1/(o*$+s*X+d*W+m*O);return n[0]=V*$,n[1]=V*X,n[2]=V*W,n[3]=V*O,n[4]=V*(A*s+w*d+R*m-(p*s+b*d+B*m)),n[5]=V*(p*o+I*d+k*m-(A*o+x*d+F*m)),n[6]=V*(b*o+x*s+M*m-(w*o+I*s+T*m)),n[7]=V*(B*o+F*s+T*d-(R*o+k*s+M*d)),n[8]=V*(L*u+U*f+C*E-(_*u+S*f+D*E)),n[9]=V*(_*a+Y*f+N*E-(L*a+H*f+P*E)),n[10]=V*(S*a+H*u+q*E-(U*a+Y*u+G*E)),n[11]=V*(D*a+P*u+G*f-(C*a+N*u+q*f)),n[12]=V*(S*g+D*v+_*c-(C*v+L*c+U*g)),n[13]=V*(P*v+L*i+H*g-(Y*g+N*v+_*i)),n[14]=V*(Y*c+G*v+U*i-(q*v+S*i+H*c)),n[15]=V*(q*g+C*i+N*c-(P*c+G*g+D*i)),n}(o([0,0,2],[0,0,0],[0,1,0])),h=function(e,n,o){o=o||new t(16);var r=e[4],i=e[5],a=e[6],s=e[7],l=e[8],c=e[9],u=e[10],d=e[11],h=Math.cos(n),g=Math.sin(n);return o[4]=h*r+g*l,o[5]=h*i+g*c,o[6]=h*a+g*u,o[7]=h*s+g*d,o[8]=h*l-g*r,o[9]=h*c-g*i,o[10]=h*u-g*a,o[11]=h*d-g*s,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}(function(e,n,o){o=o||new t(16);var r=n[0],i=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=n[8],g=n[9],f=n[10],m=n[11],y=n[12],v=n[13],E=n[14],p=n[15],A=e[0],w=e[1],b=e[2],B=e[3],R=e[4],x=e[5],I=e[6],k=e[7],F=e[8],T=e[9],M=e[10],L=e[11],_=e[12],S=e[13],U=e[14],C=e[15];return o[0]=r*A+i*R+a*F+s*_,o[1]=r*w+i*x+a*T+s*S,o[2]=r*b+i*I+a*M+s*U,o[3]=r*B+i*k+a*L+s*C,o[4]=l*A+c*R+u*F+d*_,o[5]=l*w+c*x+u*T+d*S,o[6]=l*b+c*I+u*M+d*U,o[7]=l*B+c*k+u*L+d*C,o[8]=h*A+g*R+f*F+m*_,o[9]=h*w+g*x+f*T+m*S,o[10]=h*b+g*I+f*M+m*U,o[11]=h*B+g*k+f*L+m*C,o[12]=y*A+v*R+E*F+p*_,o[13]=y*w+v*x+E*T+p*S,o[14]=y*b+v*I+E*M+p*U,o[15]=y*B+v*k+E*L+p*C,o}(c,u),v);h=function(e,n,o){o=o||new t(16);var r=e[0],i=e[1],a=e[2],s=e[3],l=e[8],c=e[9],u=e[10],d=e[11],h=Math.cos(n),g=Math.sin(n);return o[0]=h*r-g*l,o[1]=h*i-g*c,o[2]=h*a-g*u,o[3]=h*s-g*d,o[8]=h*l+g*r,o[9]=h*c+g*i,o[10]=h*u+g*a,o[11]=h*d+g*s,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}(h,x),i.useProgram(S),i.enableVertexAttribArray(U),i.enableVertexAttribArray(C),i.bindBuffer(i.ARRAY_BUFFER,H),i.vertexAttribPointer(U,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,Y),i.vertexAttribPointer(C,1,i.FLOAT,!1,0,0),i.uniformMatrix4fv(D,!1,h),i.drawArrays(i.TRIANGLES,0,36);const g=a*i.canvas.width/i.canvas.clientWidth,f=i.canvas.height-s*i.canvas.height/i.canvas.clientHeight-1,m=new Uint8Array(4);i.readPixels(g,f,1,1,i.RGBA,i.UNSIGNED_BYTE,m);const y=m[0];l=y,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.useProgram(P),i.enableVertexAttribArray(N),i.bindBuffer(i.ARRAY_BUFFER,w),i.vertexAttribPointer(N,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(G),i.bindBuffer(i.ARRAY_BUFFER,A),i.vertexAttribPointer(G,1,i.FLOAT,!1,0,0),i.enableVertexAttribArray(q),i.bindBuffer(i.ARRAY_BUFFER,p),i.vertexAttribPointer(q,2,i.FLOAT,!1,0,0),i.uniformMatrix4fv($,!1,h),i.uniform1i(X,0),i.uniform1f(W,n),i.drawArrays(i.TRIANGLES,0,36),requestAnimationFrame(e)}));let j=Date.now()}(),{getFaceState:()=>g,highlightFace:e=>{console.log("Highlighting face:",e),f=e,m.bindBuffer(m.ARRAY_BUFFER,A),R(m,f)}}}async function A(e,t){const n=document.getElementById("game-container-2d");v([{color:"#ff4949",value:"11"},{color:"#ffcc00",value:"13"},{color:"#4caf50",value:"12"},{color:"#9c27b0",value:"14"}],!1);const o=await(async e=>{const t=await y(e),n=document.createElement("canvas"),o=n.getContext("2d"),r=t.width/4,i=t.height;n.width=r,n.height=i;const a=[];for(let e=0;e<4;e++){o.clearRect(0,0,n.width,n.height),o.drawImage(t,e*r,0,r,i,0,0,r,i);const s=n.toDataURL();a.push(s)}const s=[];for(let e=0;e<4;e++)s.push(`<img style="zoom: .2" src="${a[e]}" />`);return s})(document.getElementById("canvas-img")),r=o[1],i=o[0],a=o[2],s=["red","blue","green"];let l=!1,c=e.width,u=e.height;console.log("UPDATING SQUARES PER",e,c,u);let h=((e,t)=>{const n=document.getElementById("game-container-wrapper-2d"),o=n.offsetWidth,r=n.offsetHeight,i=Math.min(Math.floor(o/e),Math.floor(r/t));return Math.min(i,300)})(c,u),g=((e,t,n)=>{try{return d(e,n*t)}catch(o){return console.warn("Error decoding",e,t,n,"using random colors instead.",o),null}})(e.colors,u,c);console.log("Init 2d level",c,u,g);const f=e=>{let t=(s.indexOf(e.style.backgroundColor)+1)%s.length;switch(e.style.backgroundColor=s[t],s[t]){case"red":e.innerHTML=r;break;case"blue":e.innerHTML=i;break;case"green":e.innerHTML=a;break;default:e.innerHTML=""}};n.style.width=c*h+"px";const m=e=>{let o=e.target.closest(".square");if(l||!o)return void console.log("CLICKING AFTER WIN");let r=Array.from(o.parentNode.children).indexOf(o),i=Math.floor(r/c),a=r%c;for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++)if(0===e&&0===t)f(o);else{let o=i+e,r=a+t;if(o>=0&&o<u&&r>=0&&r<c){let e=o*c+r,t=n.children[e];f(t)}}(()=>{const e=document.getElementsByClassName("hint-highlight");for(let t=0;t<e.length;t++)e[t].classList.remove("hint-highlight")})(),(()=>{let e=n.querySelectorAll(".square");return Array.from(e).every((e=>"red"===e.style.backgroundColor))})()&&(l=!0,setTimeout((()=>{t()}),500))};return n.addEventListener("click",m),((e,t,n,o,r,i,a,s,l)=>{console.log("INIT GRID",t);const c=n*o;e.style.gridTemplateColumns=`repeat(${n}, ${r}px)`;for(let n=0;n<c;n++){let o=document.createElement("div");o.classList.add("square"),o.style.width=`${r}px`,o.style.height=`${r}px`;let c=null===t?i[Math.floor(Math.random()*i.length)]:t[n];o.style.backgroundColor=c,"red"===c?o.innerHTML=a:"blue"===c?o.innerHTML=s:"green"===c&&(o.innerHTML=l),e.appendChild(o)}})(n,g,c,u,h,s,r,i,a),()=>{n.removeEventListener("click",m)}}class w{constructor(e,t,n,o){this.x=e,this.y=t,this.color=n,this.radius=2*Math.random()+1,this.angle=2*Math.random()*Math.PI,this.speed=5*Math.random()+.01,this.friction=o?.999:.98,this.gravity=.05,this.opacity=1,this.decay=o?.004:.01}update(){this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.opacity-=this.decay,this.opacity=Math.max(0,this.opacity)}draw(e){e.save(),e.globalAlpha=this.opacity,e.fillStyle=this.color,Math.random()>1?(e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill()):(e.font=`${this.size}px Arial`,e.fillText("13",this.x,this.y)),e.restore()}}const b="yams-2024-",B=document.getElementById("background-canvas");function R(){B.width=window.innerWidth,B.height=window.innerHeight}R(),window.addEventListener("resize",R);const x=new class{constructor(e,t){this.canvas=t,this.rate=e,this.ctx=t.getContext("2d"),console.log("Canvas",this.canvas,this.ctx),this.fireworks=[],this.animationId=null,this.isRunning=!1,this.fireworksTimeout=null}createFirework(e,t,n){const o=["#ff4949","#ffcc00","#4caf50","#2196f3","#9c27b0"],r=o[Math.floor(Math.random()*o.length)];if(n)for(let n of o)for(let o=0;o<500;o++)this.fireworks.push(new w(e,t,n,!0));else for(let n=0;n<100;n++)this.fireworks.push(new w(e,t,r,!1))}animate(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fireworks=this.fireworks.filter((e=>e.opacity>0)),this.fireworks.forEach((e=>{e.update(),e.draw(this.ctx)})),this.animationId=requestAnimationFrame(this.animate.bind(this))}sample_poisson(e){return-Math.log(Math.random())/e}createPoissonFirework(){if(!this.isRunning)return;this.createFirework(window.innerWidth*Math.random(),window.innerHeight*Math.random());const e=this.sample_poisson(10);this.fireworksTimeout=setTimeout(this.createPoissonFirework.bind(this),1e3*e)}startFireworks(){this.isRunning||(this.isRunning=!0,this.createPoissonFirework(),this.animate())}stopFireworks(){this.isRunning=!1,clearTimeout(this.fireworksTimeout),cancelAnimationFrame(this.animationId),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}(10,B),I=[{mode:"2d",colors:"QA",width:1,height:1},{mode:"2d",colors:"kA",width:1,height:3},{mode:"2d",colors:"GQ",width:1,height:4},{mode:"2d",colors:"SSFA",width:3,height:3},{mode:"2d",colors:"SSFA",width:3,height:4},{mode:"2d",colors:"SCpGRQ",width:3,height:4},{mode:"3d"}];let k,F,T=0,M=I[T];function L(e,t){return Math.random()*(t-e)+e}let _=!1;function S(){const e=document.querySelectorAll(".square");_=!0,e.forEach((e=>{const t=L(-500,500),n=L(-500,500);e.style.transform=`translate(${t}px, ${n}px)`,e.style.transition="transform 1s ease, opacity 1s ease",e.style.opacity="0.3"})),setTimeout((()=>function(){if(!1===_)return;const e=document.querySelectorAll(".square");e.forEach((e=>{e.style.transform="scale(5)",e.style.opacity="0"})),console.log("Explode squares")}()),1e3)}const U=document.getElementById("win-message"),C=()=>{document.getElementById("win-modal").style.display="none",document.getElementById("next-level").style.display="none",document.getElementById("hint-modal").style.display="none"},D=()=>{C(),T++,P(T),null!=k&&k()};document.getElementById("replay").addEventListener("click",(()=>{C(),P(T),null!=k&&k()})),document.getElementById("next-level").addEventListener("click",D);const Y=async(e,t=7)=>{if(T<=4&&(t=100),console.log("Hint with limit",t),"2d"===M.mode){const e=c(),i=(n=e,o=M.height,r=M.width,m(n,o,r,!1,t));if(console.log("Solution:",i),null!=i&&i.length>0){const e=i[0],t=document.getElementsByClassName("square");for(let n=0;n<t.length;n++){const o=t[n];n===e&&o.classList.add("hint-highlight")}}null==i&&N()}else{const e=u((e=>{let t="";return e.forEach((e=>{const n=e.toString(2).padStart(2,"0");t+=n})),t})(F.getFaceState()));console.log(e);const t=(e=>m(e,2,3,!0))(e);console.log("3d Solution:",t);const n=t[0];F.highlightFace(n)}var n,o,r};document.getElementById("hint").addEventListener("click",Y),document.getElementById("skip").addEventListener("click",(function(){T===I.length-1?H():D()}));const H=()=>{x.startFireworks();const e=document.getElementById("game-canvas-3d").getBoundingClientRect(),t=e.left+e.width/2,n=e.top+e.height/2;setTimeout((()=>x.createFirework(t,n,!0)),2e3),E=!0;const o=document.getElementById("title");o.textContent="You win!",o.style.color="white",document.getElementById("controls").style.visibility="hidden"},P=async e=>{const t=document.getElementById("game-container-2d");t.innerHTML="",x.stopFireworks(),_=!1,t.style.boxShadow="0 4px 15px rgba(128,128,128,.5)";document.getElementById("title").style.filter="";document.getElementById("controls").style.visibility="";var n=localStorage.getItem(b+e);"true"===n?(console.log("Level already beaten",e,n),document.getElementById("skip").style.display="block"):(console.log("Level not beaten",e,n),document.getElementById("skip").style.display="none"),M=I[e],console.log("Init level",e,M),document.getElementById("title").textContent=0===e?`Level ${e+1} - Make it 13`:`Level ${e+1} - Make it all 13`,"2d"===M.mode?(document.getElementById("game-container-wrapper-2d").style.visibility="unset",document.getElementById("game-canvas-3d").style.visibility="hidden",k=await A(M,(()=>{localStorage.setItem(b+e,"true"),x.startFireworks(),S(),((e,t)=>{document.getElementById("game-container-2d").style.boxShadow="unset",document.getElementById("title").style.filter="invert(1)",U.textContent=e?"Congratulations! You beat the game!":`Congratulations! You beat level ${t+1} of ${I.length}!`,document.getElementById("next-level").style.display="unset",document.getElementById("win-modal").style.display="block",document.getElementById("controls").style.visibility="hidden"})(!1,T)}))):(document.getElementById("title").textContent=`Level ${e+1} - Make it all 13 Try dragging`,document.getElementById("game-container-wrapper-2d").style.visibility="hidden",document.getElementById("game-canvas-3d").style.visibility="unset",F=p((()=>{localStorage.setItem(b+e,"true"),H()})))};document.getElementById("close-intro").addEventListener("click",(function(){document.getElementById("game-container").style.visibility="unset",document.getElementById("intro-modal").style.display="none",console.log("Starting game")})),document.getElementById("curmudgeon").addEventListener("click",(function(){window.location.href="https://dev.js13kgames.com/2024/games"})),document.getElementById("okay").addEventListener("click",(function(){C()})),document.getElementById("wait").addEventListener("click",(function(){C(),Y(0,null)}));const N=()=>{document.getElementById("hint-modal").style.display="block"};P(T)})()})();