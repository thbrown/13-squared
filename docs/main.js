(()=>{"use strict";function e(e,t,n,r){const i=["VERTEX_SHADER","FRAGMENT_SHADER"],o=t.map(((t,n)=>function(e,t,n){const r=document.getElementById(t);return function(e,t,n){const r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r}(e,r.text,n||("x-shader/x-vertex"===r.type?e.VERTEX_SHADER:e.FRAGMENT_SHADER))}(e,t,e[i[n]]))),a=e.createProgram();return o.forEach((t=>e.attachShader(a,t))),n&&n.forEach(((t,n)=>e.bindAttribLocation(a,r?r[n]:n,t))),e.linkProgram(a),a}let t=Float32Array;function n(e,n,o,a){a=a||new t(16);var s=i(function(e,n,r){return r=r||new t(3),r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}(e,n)),c=i(r(o,s)),l=i(r(s,c));return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=0,a[4]=l[0],a[5]=l[1],a[6]=l[2],a[7]=0,a[8]=s[0],a[9]=s[1],a[10]=s[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}function r(e,n,r){return(r=r||new t(3))[0]=e[1]*n[2]-e[2]*n[1],r[1]=e[2]*n[0]-e[0]*n[2],r[2]=e[0]*n[1]-e[1]*n[0],r}function i(e,n){n=n||new t(3);var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return r>1e-5&&(n[0]=e[0]/r,n[1]=e[1]/r,n[2]=e[2]/r),n}const o={0:"red",1:"blue",2:"green"},a=(e,t,n)=>{const r=t*n*2,i=s(e).substring(0,r);if(i.length!==r)throw new Error("Decoded binary string does not match the expected length.");const a=[];for(let e=0;e<i.length;e+=2){const t=parseInt(i.substring(e,e+2),2);a.push(o[t])}return a},s=e=>{switch((e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4){case 2:e+="==";break;case 3:e+="="}const t=atob(e);let n="";for(let e=0;e<t.length;e++)n+=t.charCodeAt(e).toString(2).padStart(8,"0");return n},c=e=>new Promise(((t,n)=>{const r=new Image;r.onload=function(){try{t(r)}catch(e){n(e)}},r.onerror=function(e){n(e)},r.src=e.toDataURL("image/png")})),l=(e,t=!1)=>{const n=document.getElementById("canvas-img"),r=n.getContext("2d"),i=2048;e.forEach(((e,o)=>{const a=e.color,s=e.value;r.save(),t&&(r.scale(-1,1),r.translate(-n.width,0)),r.fillStyle=a,r.fillRect(o*i,0,i,i),r.strokeStyle="black",r.lineWidth=10,r.strokeRect(o*i,0,i,i),r.font="bold 500pt Luminari";const c=s.split("").join(String.fromCharCode(8202));r.fillStyle=function(e,t,n,r){let i,o,a,s,c,l,d,u=null,h=parseInt,g=Math.round,m="string"==typeof n;if("number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||n&&!m)return null;u||(u=e=>{let t=e.length,n={};if(t>9){if([i,o,a,m]=e=e.split(","),t=e.length,t<3||t>4)return null;n.r=h("a"==i[3]?i.slice(5):i.slice(4)),n.g=h(o),n.b=h(a),n.a=m?parseFloat(m):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?e[4]+e[4]:"")),e=h(e.slice(1),16),9==t||5==t?(n.r=e>>24&255,n.g=e>>16&255,n.b=e>>8&255,n.a=g((255&e)/.255)/1e3):(n.r=e>>16,n.g=e>>8&255,n.b=255&e,n.a=-1)}return n});if(d=t.length>9,d=m?n.length>9||"c"==n&&!d:d,c=u(t),s=e<0,l=n&&"c"!=n?u(n):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(e=s?-1*e:e),!c||!l)return null;r?(i=g(s*c.r+e*l.r),o=g(s*c.g+e*l.g),a=g(s*c.b+e*l.b)):(i=g((s*c.r**2+e*l.r**2)**.5),o=g((s*c.g**2+e*l.g**2)**.5),a=g((s*c.b**2+e*l.b**2)**.5));return m=c.a,l=l.a,c=m>=0||l>=0,m=c?m<0?l:l<0?m:m*s+l*e:0,d?"rgb"+(c?"a(":"(")+i+","+o+","+a+(c?","+g(1e3*m)/1e3:"")+")":"#"+(4294967296+16777216*i+65536*o+256*a+(c?g(255*m):0)).toString(16).slice(1,c?void 0:-2)}(.7,a);const l=r.measureText(c),d=l.width,u=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,h=o*i+1024-d/2,g=(i+u)/2;r.fillText(c,h,g),r.restore()}))};let d=!1;function u(){d=!0}function h(r,i){l([{color:"#ff4949",value:"11"},{color:"#ffcc00",value:"13"},{color:"#4caf50",value:"12"},{color:"#9c27b0",value:"14"}],!0);const o=[0,0,.25,0,0,1,0,1,.25,0,.25,1],a=[.25,0,.5,0,.25,1,.25,1,.5,0,.5,1],s=[.5,0,.75,0,.5,1,.5,1,.75,0,.75,1],u=[.75,0,1,0,.75,1,.75,1,1,0,1,1],h=[0,0,.25,0,0,1,.25,0,.25,1,0,1],g=[.25,0,.5,0,.25,1,.5,0,.5,1,.25,1],m=[.5,0,.75,0,.5,1,.75,0,.75,1,.5,1],f=[.75,0,1,0,.75,1,1,0,1,1,.75,1],y=[0,1,2,0,1,2];function v(e){var t=new Float32Array([-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]);e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}function E(e,t){e.bufferData(e.ARRAY_BUFFER,new Float32Array([...w(t[0],!0),...w(t[1]),...w(t[2],!0),...w(t[3]),...w(t[4],!0),...w(t[5])]),e.STATIC_DRAW)}function w(e,t=!1){return 0===e?t?h:o:1===e?t?g:a:2===e?t?m:s:3===e?t?f:u:(console.warn("Invalid texture index:",e),alert("Invalid texture index:"+e),null)}!function(){var r=document.querySelector("#game-canvas-3d"),o=r.getContext("webgl");if(!o)return;let a=-1,s=-1,l=-1,u=!1,h=0,g=y;var m=G(60),f=G(0),w=G(0);function b(e){const t=r.getBoundingClientRect();return e.touches&&e.touches.length>0?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:e.changedTouches&&e.changedTouches.length>0?{x:e.changedTouches[0].clientX-t.left,y:e.changedTouches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}const p=e=>{if(h>10)return;h=0;const t=e=>{e.forEach((e=>{g[e]=(g[e]+1)%3}))};switch(l){case 1:t([0,4,2,5,3]);break;case 2:t([1,4,2,5,3]);break;case 3:t([2,4,5,0,1]);break;case 4:t([3,4,5,0,1]);break;case 5:t([4,2,3,0,1]);break;case 6:t([5,2,3,0,1]);break;case-1:break;default:console.log("Unknown color",l)}!async function(){console.log("Changing texture...",g);try{E(o,g),console.log("Texture changed successfully!")}catch(e){console.error("Error updating texture:",e),alert("Error updating texture:"+e)}}(),setTimeout(I,100)};function A(e){e.preventDefault();const{x:t,y:n}=b(e);if(a=t,s=n,u){let t=e.touches?e.touches[0].clientX-B:e.movementX,n=e.touches?e.touches[0].clientY-x:e.movementY;h+=Math.abs(t)+Math.abs(n),w+=t/100,f+=n/100,e.touches&&(B=e.touches[0].clientX,x=e.touches[0].clientY)}}o.canvas.addEventListener("mousemove",A),o.canvas.addEventListener("mousedown",(e=>{u=!0,h=0})),o.canvas.addEventListener("mouseup",(e=>{u=!1}));let B=0,x=0;o.canvas.addEventListener("touchstart",(e=>{u=!0,h=0;const{x:t,y:n}=b(e);a=t,s=n,B=e.touches[0].clientX,x=e.touches[0].clientY,e.preventDefault()})),o.canvas.addEventListener("touchmove",A),o.canvas.addEventListener("touchend",(e=>{u=!1})),o.canvas.addEventListener("click",p),o.canvas.addEventListener("touchend",(e=>{p(),e.preventDefault()}));const R=2;function I(){let e=!0;for(let t=0;t<g.length;t++)if(g[t]!==R){e=!1;break}e&&i()}!async function(){const e=await c(document.getElementById("canvas-img"));o.bindTexture(o.TEXTURE_2D,q),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e),o.generateMipmap(o.TEXTURE_2D)}();const T=e(o,["pick-vertex-shader","pick-fragment-shader"]);var k=o.getAttribLocation(T,"a_position"),F=o.getAttribLocation(T,"a_picking_color"),M=o.getUniformLocation(T,"u_matrix"),L=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,L),function(e){var t=[1,2,3,4,5,6].map((e=>e/255)),n=[];t.forEach((e=>{for(var t=0;t<6;t++)n.push(e)})),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW)}(o);var _=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,_),v(o);var S=e(o,["vertex-shader-3d","fragment-shader-3d"]),C=o.getAttribLocation(S,"a_position"),U=o.getAttribLocation(S,"a_texcoord"),D=o.getUniformLocation(S,"u_matrix"),Y=o.getUniformLocation(S,"u_texture"),H=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,H),v(o);var P=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,P),E(o,y);var q=o.createTexture();function G(e){return e*Math.PI/180}o.bindTexture(o.TEXTURE_2D,q),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([0,0,255,0,255,0,255,0,0,255,255,0])),requestAnimationFrame((function e(){if(function(e,t=1){const n=e.clientWidth*t|0,r=e.clientHeight*t|0;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}(o.canvas),o.viewport(0,0,o.canvas.width,o.canvas.height),o.enable(o.CULL_FACE),o.enable(o.DEPTH_TEST),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),d){const e=G(1);m=Math.min(Math.PI,m+e);const t=G(10),n=G(10);f+=t,w+=n}let r=o.canvas.clientWidth/o.canvas.clientHeight,i=function(e,n,r,i,o){o=o||new t(16);var a=Math.tan(.5*Math.PI-.5*e),s=1/(r-i);return o[0]=a/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+i)*s,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*i*s*2,o[15]=0,o}(m,r,1,2e3),c=function(e,n){n=n||new t(16);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],h=e[9],g=e[10],m=e[11],f=e[12],y=e[13],v=e[14],E=e[15],w=g*E,b=v*m,p=l*E,A=v*d,B=l*m,x=g*d,R=o*E,I=v*a,T=o*m,k=g*a,F=o*d,M=l*a,L=u*y,_=f*h,S=s*y,C=f*c,U=s*h,D=u*c,Y=r*y,H=f*i,P=r*h,q=u*i,G=r*c,X=s*i,$=w*c+A*h+B*y-(b*c+p*h+x*y),N=b*i+R*h+k*y-(w*i+I*h+T*y),O=p*i+I*c+F*y-(A*i+R*c+M*y),W=x*i+T*c+M*h-(B*i+k*c+F*h),V=1/(r*$+s*N+u*O+f*W);return n[0]=V*$,n[1]=V*N,n[2]=V*O,n[3]=V*W,n[4]=V*(b*s+p*u+x*f-(w*s+A*u+B*f)),n[5]=V*(w*r+I*u+T*f-(b*r+R*u+k*f)),n[6]=V*(A*r+R*s+M*f-(p*r+I*s+F*f)),n[7]=V*(B*r+k*s+F*u-(x*r+T*s+M*u)),n[8]=V*(L*d+C*m+U*E-(_*d+S*m+D*E)),n[9]=V*(_*a+Y*m+q*E-(L*a+H*m+P*E)),n[10]=V*(S*a+H*d+G*E-(C*a+Y*d+X*E)),n[11]=V*(D*a+P*d+X*m-(U*a+q*d+G*m)),n[12]=V*(S*g+D*v+_*l-(U*v+L*l+C*g)),n[13]=V*(P*v+L*o+H*g-(Y*g+q*v+_*o)),n[14]=V*(Y*l+X*v+C*o-(G*v+S*o+H*l)),n[15]=V*(G*g+U*o+q*l-(P*l+X*g+D*o)),n}(n([0,0,2],[0,0,0],[0,1,0])),u=function(e,n,r){r=r||new t(16);var i=e[4],o=e[5],a=e[6],s=e[7],c=e[8],l=e[9],d=e[10],u=e[11],h=Math.cos(n),g=Math.sin(n);return r[4]=h*i+g*c,r[5]=h*o+g*l,r[6]=h*a+g*d,r[7]=h*s+g*u,r[8]=h*c-g*i,r[9]=h*l-g*o,r[10]=h*d-g*a,r[11]=h*u-g*s,e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}(function(e,n,r){r=r||new t(16);var i=n[0],o=n[1],a=n[2],s=n[3],c=n[4],l=n[5],d=n[6],u=n[7],h=n[8],g=n[9],m=n[10],f=n[11],y=n[12],v=n[13],E=n[14],w=n[15],b=e[0],p=e[1],A=e[2],B=e[3],x=e[4],R=e[5],I=e[6],T=e[7],k=e[8],F=e[9],M=e[10],L=e[11],_=e[12],S=e[13],C=e[14],U=e[15];return r[0]=i*b+o*x+a*k+s*_,r[1]=i*p+o*R+a*F+s*S,r[2]=i*A+o*I+a*M+s*C,r[3]=i*B+o*T+a*L+s*U,r[4]=c*b+l*x+d*k+u*_,r[5]=c*p+l*R+d*F+u*S,r[6]=c*A+l*I+d*M+u*C,r[7]=c*B+l*T+d*L+u*U,r[8]=h*b+g*x+m*k+f*_,r[9]=h*p+g*R+m*F+f*S,r[10]=h*A+g*I+m*M+f*C,r[11]=h*B+g*T+m*L+f*U,r[12]=y*b+v*x+E*k+w*_,r[13]=y*p+v*R+E*F+w*S,r[14]=y*A+v*I+E*M+w*C,r[15]=y*B+v*T+E*L+w*U,r}(i,c),f);u=function(e,n,r){r=r||new t(16);var i=e[0],o=e[1],a=e[2],s=e[3],c=e[8],l=e[9],d=e[10],u=e[11],h=Math.cos(n),g=Math.sin(n);return r[0]=h*i-g*c,r[1]=h*o-g*l,r[2]=h*a-g*d,r[3]=h*s-g*u,r[8]=h*c+g*i,r[9]=h*l+g*o,r[10]=h*d+g*a,r[11]=h*u+g*s,e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}(u,w),o.useProgram(T),o.enableVertexAttribArray(k),o.enableVertexAttribArray(F),o.bindBuffer(o.ARRAY_BUFFER,_),o.vertexAttribPointer(k,3,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,L),o.vertexAttribPointer(F,1,o.FLOAT,!1,0,0),o.uniformMatrix4fv(M,!1,u),o.drawArrays(o.TRIANGLES,0,36);const h=a*o.canvas.width/o.canvas.clientWidth,g=o.canvas.height-s*o.canvas.height/o.canvas.clientHeight-1,y=new Uint8Array(4);o.readPixels(h,g,1,1,o.RGBA,o.UNSIGNED_BYTE,y);const v=y[0];l=v,o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.useProgram(S),o.enableVertexAttribArray(C),o.bindBuffer(o.ARRAY_BUFFER,H),o.vertexAttribPointer(C,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(U),o.bindBuffer(o.ARRAY_BUFFER,P),o.vertexAttribPointer(U,2,o.FLOAT,!1,0,0),o.uniformMatrix4fv(D,!1,u),o.uniform1i(Y,0),o.drawArrays(o.TRIANGLES,0,36),requestAnimationFrame(e)}))}()}async function g(e,t,n,r,i){const o=document.getElementById("game-container-2d");document.getElementById("game-container-wrapper-2d");l([{color:"#ff4949",value:"11"},{color:"#ffcc00",value:"13"},{color:"#4caf50",value:"12"},{color:"#9c27b0",value:"14"}],!1);const s=await(async e=>{const t=await c(e),n=document.createElement("canvas"),r=n.getContext("2d"),i=t.width/4,o=t.height;n.width=i,n.height=o;const a=[];for(let e=0;e<4;e++){r.clearRect(0,0,n.width,n.height),r.drawImage(t,e*i,0,i,o,0,0,i,o);const s=n.toDataURL();a.push(s)}const s=[];for(let e=0;e<4;e++)s.push(`<img style="zoom: .2" src="${a[e]}" />`);return s})(document.getElementById("canvas-img"));e=s[1],t=s[0],n=s[2];const d=["red","blue","green"];let u=!1,h=r.width,g=r.height,m=((e,t)=>{const n=document.getElementById("game-container-wrapper-2d"),r=n.offsetWidth,i=n.offsetHeight,o=Math.min(Math.floor(r/e),Math.floor(i/t));return Math.min(o,300)})(h,g),f=((e,t,n)=>{try{return a(e,n,t)}catch(r){return console.warn("Error decoding",e,t,n,"using random colors instead.",r),null}})(r.colors,g,h);console.log("Init 2d level",h,g,f);const y=r=>{let i=(d.indexOf(r.style.backgroundColor)+1)%d.length;switch(r.style.backgroundColor=d[i],d[i]){case"red":r.innerHTML=e;break;case"blue":r.innerHTML=t;break;case"green":r.innerHTML=n;break;default:r.innerHTML=""}};o.style.width=h*m+"px",o.addEventListener("click",(e=>{let t=e.target.closest(".square");if(u||!t)return;let n=Array.from(t.parentNode.children).indexOf(t),r=Math.floor(n/h),a=n%h;for(let e=-1;e<=1;e++)for(let n=-1;n<=1;n++)if(0===e&&0===n)y(t);else{let t=r+e,i=a+n;if(t>=0&&t<g&&i>=0&&i<h){let e=t*h+i,n=o.children[e];y(n)}}(()=>{let e=o.querySelectorAll(".square");return Array.from(e).every((e=>"red"===e.style.backgroundColor))})()&&(u=!0,setTimeout((()=>{i()}),500))})),((e,t,n,r,i,o,a,s,c)=>{console.log("INIT GRID",t);const l=n*r;e.style.gridTemplateColumns=`repeat(${n}, ${i}px)`;for(let n=0;n<l;n++){let r=document.createElement("div");r.classList.add("square"),r.style.width=`${i}px`,r.style.height=`${i}px`;let l=null===t?o[Math.floor(Math.random()*o.length)]:t[n];r.style.backgroundColor=l,"red"===l?r.innerHTML=a:"blue"===l?r.innerHTML=s:"green"===l&&(r.innerHTML=c),e.appendChild(r)}})(o,f,h,g,m,d,e,t,n)}class m{constructor(e,t,n,r){this.x=e,this.y=t,this.color=n,this.radius=2*Math.random()+1,this.angle=2*Math.random()*Math.PI,this.speed=5*Math.random()+.01,this.friction=r?.999:.98,this.gravity=.05,this.opacity=1,this.decay=r?.004:.01}update(){this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.opacity-=this.decay,this.opacity=Math.max(0,this.opacity)}draw(e){e.save(),e.globalAlpha=this.opacity,e.fillStyle=this.color,Math.random()>1?(e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill()):(e.font=`${this.size}px Arial`,e.fillText("13",this.x,this.y)),e.restore()}}let f=document.querySelectorAll("svg"),y=Array.from(f).map((e=>e.outerHTML));const v=document.getElementById("background-canvas");function E(){v.width=window.innerWidth,v.height=window.innerHeight}E(),window.addEventListener("resize",E);const w=new class{constructor(e,t){this.canvas=t,this.rate=e,this.ctx=t.getContext("2d"),console.log("Canvas",this.canvas,this.ctx),this.fireworks=[],this.animationId=null,this.isRunning=!1,this.fireworksTimeout=null}createFirework(e,t,n){const r=["#ff4949","#ffcc00","#4caf50","#2196f3","#9c27b0"],i=r[Math.floor(Math.random()*r.length)];if(n)for(let n of r)for(let r=0;r<500;r++)this.fireworks.push(new m(e,t,n,!0));else for(let n=0;n<100;n++)this.fireworks.push(new m(e,t,i,!1))}animate(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fireworks=this.fireworks.filter((e=>e.opacity>0)),this.fireworks.forEach((e=>{e.update(),e.draw(this.ctx)})),this.animationId=requestAnimationFrame(this.animate.bind(this))}sample_poisson(e){return-Math.log(Math.random())/e}createPoissonFirework(){if(!this.isRunning)return;this.createFirework(window.innerWidth*Math.random(),window.innerHeight*Math.random());const e=this.sample_poisson(10);this.fireworksTimeout=setTimeout(this.createPoissonFirework.bind(this),1e3*e)}startFireworks(){this.isRunning||(this.isRunning=!0,this.createPoissonFirework(),this.animate())}stopFireworks(){this.isRunning=!1,clearTimeout(this.fireworksTimeout),cancelAnimationFrame(this.animationId),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}(10,v),b=[{mode:"2d",colors:"QA",width:1,height:1},{mode:"2d",colors:"kA",width:1,height:3},{mode:"2d",colors:"GQ",width:1,height:4},{mode:"3d"}];let p=0;function A(e,t){return Math.random()*(t-e)+e}let B=!1;function x(){const e=document.querySelectorAll(".square");B=!0,e.forEach((e=>{const t=A(-500,500),n=A(-500,500);e.style.transform=`translate(${t}px, ${n}px)`,e.style.transition="transform 1s ease, opacity 1s ease",e.style.opacity="0.3"})),setTimeout((()=>function(){if(!1===B)return;const e=document.querySelectorAll(".square");e.forEach((e=>{e.style.transform="scale(5)",e.style.opacity="0"})),console.log("Explode squares")}()),1e3)}const R=document.getElementById("win-message"),I=()=>{document.getElementById("win-modal").style.display="none",document.getElementById("next-level").style.display="none"},T=()=>{I(),p++,M(p)};document.getElementById("replay").addEventListener("click",(()=>{I(),M(p)})),document.getElementById("next-level").addEventListener("click",T);const k=document.getElementById("hint"),F=document.getElementById("skip");k.addEventListener("click",(function(){x(),w.startFireworks();const e=document.getElementById("game-canvas-3d").getBoundingClientRect(),t=e.left+e.width/2,n=e.top+e.height/2;setTimeout((()=>w.createFirework(t,n,!0)),2e3),u();const r=document.getElementById("title");r.textContent="You win!",r.style.color="white",document.getElementById("controls").style.visibility="hidden"})),F.addEventListener("click",(function(){T()}));const M=e=>{const t=document.getElementById("game-container-2d");t.innerHTML="",w.stopFireworks(),B=!1,t.style.boxShadow="0 4px 15px rgba(128,128,128,.5)";document.getElementById("title").style.filter="";document.getElementById("controls").style.visibility="";const n=b[e];console.log("Init level",e,n),document.getElementById("title").textContent=0===e?`Level ${e+1} - Make it 13`:`Level ${e+1} - Make it all 13`,"2d"===n.mode?(document.getElementById("game-container-wrapper-2d").style.visibility="unset",document.getElementById("game-canvas-3d").style.visibility="hidden",g(y[2],y[0],y[1],n,(()=>{w.startFireworks(),x(),((e,t)=>{document.getElementById("game-container-2d").style.boxShadow="unset",document.getElementById("title").style.filter="invert(1)",R.textContent=e?"Congratulations! You beat the game!":`Congratulations! You beat level ${t+1} of ${b.length}!`,document.getElementById("next-level").style.display="unset",document.getElementById("win-modal").style.display="block",document.getElementById("controls").style.visibility="hidden"})(!1,p)}))):(document.getElementById("title").textContent=`Level ${e+1} - Make it all 13 Try dragging`,document.getElementById("game-container-wrapper-2d").style.visibility="hidden",document.getElementById("game-canvas-3d").style.visibility="unset",h(0,(()=>{w.startFireworks();const e=document.getElementById("game-canvas-3d").getBoundingClientRect(),t=e.left+e.width/2,n=e.top+e.height/2;setTimeout((()=>w.createFirework(t,n,!0)),2e3),u();const r=document.getElementById("title");r.textContent="You win!",r.style.color="white",document.getElementById("controls").style.visibility="hidden"})))};document.getElementById("close-intro").addEventListener("click",(function(){document.getElementById("game-container").style.visibility="unset",document.getElementById("intro-modal").style.display="none",console.log("Starting game")})),document.getElementById("curmudgeon").addEventListener("click",(function(){window.location.href="https://dev.js13kgames.com/2024/games"})),M(p)})();